{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "spacing": 8,
  "hconcat": [
    {
      "width": 680,
      "height": 270,
      "projection": { "type": "mercator", "center": [98.7, 8.5], "scale": 1870 },
      "view": { "stroke": "transparent" },
      "title": { "text": "Tree-cover gain by state (2000â€“2020)", "anchor": "start" , "font": "Geograph"},
      "layer": [
        { "data": { "sphere": true }, "mark": { "type": "geoshape", "fill": "#8fc2f2" } },
        { "data": { "graticule": { "step": [5, 5] } }, "mark": { "type": "geoshape", "stroke": "#d7e3ee", "strokeWidth": 0.4 } },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/Xin-999/3179/refs/heads/main/Forest/js/gadm41_MYS_1.topojson",
            "format": { "type": "topojson", "feature": "gadm41_MYS_1" }
          },
          "mark": { "type": "geoshape", "fill": "#f8fafc", "stroke": "#264a63", "strokeWidth": 0.6 }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/Xin-999/3179/refs/heads/main/Forest/data/forest_gain_clean.csv",
            "format": { "type": "csv" }
          },
          "transform": [
            { "calculate": "datum.gain_ha > 70000 ? 300000 : (datum.gain_ha < 10000 ? 0.01 : 5000)", "as": "gain_cat" },
            { "calculate": "clamp((datum.gain_cat - 0) / 300000, 0, 1)", "as": "t" },
            { "calculate": "8 + pow(datum.t, 0.3) * (30 - 8)", "as": "h" },
            { "calculate": "'M -0.6 0 L 0 -' + datum.h + ' L 0.6 0 Z'", "as": "spikePath" }
          ],
          "mark": { "type": "point", "filled": true, "opacity": 0.95, "stroke": "#0f172a", "strokeWidth": 0.6 },
          "encoding": {
            "longitude": { "field": "lon" },
            "latitude": { "field": "lat" },
            "shape": { "field": "spikePath", "type": "nominal", "scale": null },
            "color": { "value": "#74c476" },
            "tooltip": [
              { "field": "state", "title": "State" },
              { "field": "gain_ha", "title": "Gain (ha)", "format": ",.0f" }
            ]
          }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/Xin-999/3179/refs/heads/main/Forest/data/forest_gain_clean.csv",
            "format": { "type": "csv" }
          },
          "mark": { "type": "text", "align": "right", "fontSize": 8, "fill": "#666565" },
          "encoding": {
            "longitude": { "field": "lon" },
            "latitude": { "field": "lat" },
            "text": { "field": "state" }
          }
        }
      ]
    },
    {
      "width": 140,
      "height": 300,
      "view": { "stroke": "transparent" },
      "vconcat": [
        {
          "data": { "values": [{}] },
          "mark": { "type": "text", "align": "left", "fontSize": 12, "fontWeight": "bold" },
          "encoding": { "x": { "value": 8 }, "y": { "value": 14 }, "text": { "value": "Gain (ha)" } }
        },
        {
          "width": 140,
          "height": 250,
          "data": {
            "values": [
              { "label": "  > 70,000", "gain_ha": 300000 },
              { "label": "70,000", "gain_ha": 5000 },
              { "label": "  < 10,000", "gain_ha": 0.01 }
            ]
          },
          "transform": [
            { "calculate": "clamp((datum.gain_ha - 0) / 300000, 0, 1)", "as": "t" },
            { "calculate": "8 + pow(datum.t, 0.3) * (30 - 8)", "as": "h" },
            { "calculate": "'M -0.6 0 L 0 -' + datum.h + ' L 0.6 0 Z'", "as": "spikePath" }
          ],
          "layer": [
            {
              "mark": { "type": "point", "filled": true, "opacity": 0.95, "stroke": "#0f172a", "strokeWidth": 0.6 },
              "encoding": {
                "x": { "value": 30 },
                "y": { "field": "label", "type": "nominal", "sort": ["> 300,000", "150,000", "< 50,000"], "axis": null },
                "shape": { "field": "spikePath", "type": "nominal", "scale": null },
                "color": { "value": "#74c476" }
              }
            },
            {
              "mark": { "type": "text", "align": "right", "baseline": "middle", "dx": -12, "fontSize": 11 ,"dy": -6 },
              "encoding": {
                "x": { "value": 90 },
                "y": { "field": "label", "type": "nominal", "sort": ["> 300,000", "150,000", "< 50,000"],"scale": { "range":  [60, 230, 550] } },
                "text": { "field": "label" }
              }
            }
          ]
        }
      ]
    }
  ],
  "config": {
    "view": { "stroke": "transparent" },
    "padding": { "top": 0, "bottom": 5, "left": 0, "right": 0 }
  }
}
