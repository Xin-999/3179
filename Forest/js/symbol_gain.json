{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": "container",
  "height": 300,
  "background": "white",
    "autosize": { "type": "fit", "contains": "padding", "resize": true },
  "projection": { "type": "mercator", "center": [109.5, 4.0], "scale": 2150 },
  "view": { "stroke": "transparent" },
  "title": { "text": "Malaysia â€” Tree-cover gain by state (ha)", "fontSize": 18, "anchor": "start" },


  "layer": [
    {
      "data": { "sphere": true },
      "mark": { "type": "geoshape", "fill": "#8fc2f2" }
    },
    {
      "data": { "graticule": { "step": [5, 5] } },
      "mark": { "type": "geoshape", "stroke": "#d7e3ee", "strokeWidth": 0.4 }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Xin-999/3179/refs/heads/main/Forest/js/gadm41_MYS_1.topojson",
        "format": { "type": "topojson", "feature": "gadm41_MYS_1" }
      },
      "mark": { "type": "geoshape", "fill": "#f8fafc", "stroke": "#264a63", "strokeWidth": 0.6 }
    },


    {
      "data": {
        "url": "https://raw.githubusercontent.com/Xin-999/3179/refs/heads/main/Forest/data/forest_gain_clean.csv",
        "format": { "type": "csv" }
      },
      "transform": [
        {
          "joinaggregate": [
            { "op": "min", "field": "gain_ha", "as": "gmin" },
            { "op": "max", "field": "gain_ha", "as": "gmax" }
          ]
        },
        {
          "calculate": "clamp((datum.gain_ha - datum.gmin) / max(1e-9, datum.gmax - datum.gmin), 0, 1)",
          "as": "t"
        },
          { "calculate": "8 + pow(datum.t, 0.3) * (30- 8)", "as": "h" }
        ,{ "calculate": "'M -1 0 L 0 -' + datum.h + ' L 1 0 Z'", "as": "spikePath" }
      ],
      "mark": {
        "type": "point",
        "filled": true,
        "opacity": 0.95,
        "stroke": "#0f172a",
        "strokeWidth": 0.6
      },
      "encoding": {
        "longitude": { "field": "lon", "type": "quantitative" },
        "latitude":  { "field": "lat", "type": "quantitative" },
        "shape":     { "field": "spikePath", "type": "nominal", "scale": null },
        "color":     { "value": "#74c476" },
        "tooltip": [
          { "field": "state", "title": "State" },
          { "field": "gain_ha", "title": "Gain (ha)", "format": ",.0f" }
        ]
      }
    },


    {
      "data": {
        "url": "https://raw.githubusercontent.com/Xin-999/3179/refs/heads/main/Forest/data/forest_gain_clean.csv",
        "format": { "type": "csv" }
      },
      "transform": [
        { "calculate": "datum.state", "as": "label" }
      ],
      "mark": { "type": "text", "align":"right",  "fontSize": 8, "fill": "#666565" },
      "encoding": {
        "longitude": { "field": "lon" },
        "latitude":  { "field": "lat" },
        "text": { "field": "label" }
      }
    }
  ],


  "config": {
    "view": { "stroke": "transparent" },
    "padding": { "top": 0, "bottom": 5, "left": 0, "right": 0 },
    "legend": { "titleFontSize": 12, "labelFontSize": 11, "symbolType": "circle" }
  }
}
